#
#	ksh Push/Pop directory package
#
#ident	"@(#)HOME:.kshdir	1.1	93/11/17 19:21:21 (woods)"

# Variables: _dir_stack, _dir_stack_top
#
# Functions: pushd, popd, showd, #sd, sd_init
#

typeset -i10 _dir_stack_top
_dir_stack[0]=""
_dir_stack_top=0

function to_tilde
{
	case $1 in
	$HOME)
		echo "~"
		;;
	/*)
		echo "$1"
		;;
	*)
		echo "~/$1"
		;;
	esac
}

function popd
{
	typeset -i10 pop_size

	if [ $# -gt 1 ]; then
		echo "Usage: $0 [number]" >&2
		unset pop_size
		return 2
	fi
	if [ $# -eq 1 ]; then
		if [ "${1##[0-9]*}" = "" -o "${1##-[0-9]*}" = "" ]; then
			pop_size=$1
		else
			echo "Usage: $0 [number]" >&2
			unset pop_size
			return 2
		fi
	else
		pop_size=-1
	fi
	if [ $pop_size -lt 0 ]; then
		((pop_size=-pop_size))
	else
		((pop_size=_dir_stack_top-pop_size+1))
	fi
	if [ $_dir_stack_top -lt "$pop_size" ]; then
		echo "$0: The directory stack does not have $pop_size elements." >&2
	fi
	((_dir_stack_top=_dir_stack_top-pop_size))
	unset pop_size
	cd ${_dir_stack[$_dir_stack_top]}
}


function pushd
{
	if [ $# -ne 1 ]; then
		echo "Usage: $0 [directory]" >&2
		return 2
	fi
	if [ $# -eq 1 ]; then
		_dir_stack[_dir_stack_top]=$PWD
		((_dir_stack_top=_dir_stack_top+1))
		cd $1
	else
		cd ${_dir_stack[_dir_stack_top-1]}
		_dir_stack[_dir_stack_top-1]=$OLDPWD
	fi
}

function showd
{
	typeset -i10 neg_count count pos_count

	neg_count=0 
	count=1
	pos_count=$_dir_stack_top+1

	echo "	 `to_tilde $PWD`"
	while [ $pos_count -gt 1 ]; do
		((pos_count=pos_count-1))
		((neg_count=neg_count-1))
		((count=count+1))
		echo $pos_count $neg_count ${_dir_stack[_dir_stack_top-count+1]}
	done
	echo ""
	echo "OTHER WAY:"
 	print -r - "`to_tilde $PWD` ${_dir_stack[@]}"

	unset neg_count count pos_count
}


## function sd
## {
## 	if [ $# -ne 1 ]; then
## 		showd
## 		return 0
## 	fi
## 	if [ "${1##[0-9]*}" = "" -o "${1##-[0-9]*}" = "" ]; then
## 		switch_index=$1
## 	else
## 		echo "$0: argument must be numeric." >&2
## 		showd
## 		return 1
## 	fi
## 	if [ $switch_index -eq 0 ]; then
## 		cd
## 		unset switch_index
## 		return 0
## 	fi
## 	if [ $switch_index -lt 1 ]; then
## 		((switch_index=-switch_index))
## 	else
## 		((switch_index=_dir_stack_top - switch_index + 1))
## 	fi
## 	if [ $_dir_stack_top -lt $switch_index -o $switch_index -lt 1 ]; then
## 		echo "$0: The directory stack does not have $switch_index elements." >&2
## 	fi
## 	cd ${_dir_stack[_dir_stack_top-switch_index]}
## 	unset switch_index
## }
## 
## 
## function sd_init
## {
## 	_dir_stack[0]=""
## 	_dir_stack_top=0
## 	sd_init_list="$HOME/*"
## 
## 	for dir_path in $std_init_list ; do
## 		_dir_stack[_dir_stack_top]="$dir_path"
## 		((_dir_stack_top=_dir_stack_top+1))
## 	done
## 	unset sd_init_list dir_path
## }
## 
## typeset -fx popd pushd showd sd sd_init

typeset -fx popd pushd showd
